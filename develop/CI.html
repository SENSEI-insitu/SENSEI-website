<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#"><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>sensei</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://sensei-insitu.org/develop/CI.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://sensei-insitu.org/develop/CI.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="sensei">
  <!-- Open Graph -->
  <meta name="description" content="Continuous Integration (CI)A System has been devised for testing and continuous integration using GitHub Workflows. By leveraging these tools, the SENSEI project is able to ensure the quality of the s">
<meta property="og:type" content="website">
<meta property="og:title" content="sensei">
<meta property="og:url" content="https://sensei-insitu.org/develop/CI.html">
<meta property="og:site_name" content="sensei">
<meta property="og:description" content="Continuous Integration (CI)A System has been devised for testing and continuous integration using GitHub Workflows. By leveraging these tools, the SENSEI project is able to ensure the quality of the s">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2021-06-22T23:31:23.837Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sensei">
<meta name="twitter:description" content="Continuous Integration (CI)A System has been devised for testing and continuous integration using GitHub Workflows. By leveraging these tools, the SENSEI project is able to ensure the quality of the s">
  <!-- Google Analytics -->
  
</head>

<body>
  <div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/" id="logo">sensei</a>
    </h1>
    <nav id="main-nav">
      <a href="/learn-more/" class="main-nav-link">Learn more</a><a href="/develop/" class="main-nav-link">Develop</a><a href="/news/" class="main-nav-link">News</a>
      <a href="https://github.com/SENSEI-insitu/SENSEI" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <header class="article-header">
                <h1 class="article-title" itemprop="name"></h1>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h1 id="Continuous-Integration-CI" class="article-heading"><a href="#Continuous-Integration-CI" class="headerlink" title="Continuous Integration (CI)"></a>Continuous Integration (CI)<a class="article-anchor" href="#Continuous-Integration-CI" aria-hidden="true"></a></h1><p>A System has been devised for testing and continuous integration using <a href="https://github.com/kwryankrattiger/sensei/tree/ryan-ci-test/.github/workflows" target="_blank" rel="noopener">GitHub Workflows</a>. By leveraging these tools, the SENSEI project is able to ensure the quality of the software when it is integrated into the ECP software stack.</p>
<h1 id="Setting-up-a-new-CI-job" class="article-heading"><a href="#Setting-up-a-new-CI-job" class="headerlink" title="Setting up a new CI job"></a>Setting up a new CI job<a class="article-anchor" href="#Setting-up-a-new-CI-job" aria-hidden="true"></a></h1><p>An example using the GitHub Workflows can be found at <a href="https://github.com/kwryankrattiger/sensei/blob/ryan-ci-test/.github/workflows/os-linux.yml" target="_blank" rel="noopener">os-linux</a>.</p>
<p>The three main steps of the CI workflow are:</p>
<ul>
<li><a href="#Configure">Configure</a></li>
<li><a href="#Build">Build</a></li>
<li><a href="#Test">Test</a></li>
<li><a href="#Upload-Artifacts">Upload Artifacts</a></li>
</ul>
<h2 id="Configure" class="article-heading"><a href="#Configure" class="headerlink" title="Configure"></a>Configure<a class="article-anchor" href="#Configure" aria-hidden="true"></a></h2><p>This step sets the stage for the rest of the downstream steps. Here we configure the build and tests for the OS and features the CI will test. For this, SENSEI uses a collection of modular CMake scripts that build the CMakeCache.txt. The name of the configuration is generally the same as the name of the job. In the example <a href="yaml">os-linux</a> the job <code>linux-ecp</code> using the configuration <code>linux_ecp</code>.</p>
<p>The configuration is controlled by two environment variables</p>
<ul>
<li><code>CMAKE_CONFIGURATION</code>: This variable is <em>required</em> to be set. An example is <code>linux_ecp</code> which is used for the <code>linux-ecp</code> <a href="https://github.com/kwryankrattiger/sensei/blob/ryan-ci-test/.github/workflows/os-linux.yml" target="_blank" rel="noopener">job</a></li>
<li><code>CMAKE_GENERATOR</code>: This sets the generator cmake will use to build, the default generator is “Ninja”.</li>
<li><code>CMAKE_BUILD_TYPE</code>: This sets the build type, the default build type is “Debug”.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_configure.cmake</span></span><br></pre></td></tr></table></figure>
<h2 id="Build" class="article-heading"><a href="#Build" class="headerlink" title="Build"></a>Build<a class="article-anchor" href="#Build" aria-hidden="true"></a></h2><p>The build step is where SENSEI is built using all of the features specified by the configuration.</p>
<p>There are some environment variables that may be set for the CI job to modify how the build step performs.</p>
<ul>
<li><code>CTEST_MAX_PARALLELISM</code>: This limits the number of consequtive compilations tasks, for GitHub Actions this currently defaults to “2”.</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_build.cmake</span></span><br></pre></td></tr></table></figure>
<h2 id="Test" class="article-heading"><a href="#Test" class="headerlink" title="Test"></a>Test<a class="article-anchor" href="#Test" aria-hidden="true"></a></h2><p>The testing step is where the SENSEI tests are run. This includes the tests that use the miniapps and standalone drivers that test specific bridges. Depending on the features enabled during configuration, certain tests will be enable or disabled accordingly.</p>
<p>A note about GitHub Actions:</p>
<p>Due to that fact that GitHub Actions only provides two(2) cores for running CI it was decided to disable all tests that run with more than two(2) cores. Most of the tests marked <code>PARALLEL</code> run with 4 cores, so the current method of disabling tests that use more than two(2) cores is to disable all tests labeld <code>PARALLEL</code> if the environment variable <code>CTEST_MAX_PARALLELISM</code> &lt; four(4).</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Test</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_test.cmake</span></span><br></pre></td></tr></table></figure>
<h2 id="Upload-Artifacts" class="article-heading"><a href="#Upload-Artifacts" class="headerlink" title="Upload Artifacts"></a>Upload Artifacts<a class="article-anchor" href="#Upload-Artifacts" aria-hidden="true"></a></h2><p>This last step is to store the result of the CI. This step is optional because it may not be desirable or needed to keep artifacts of the CI job around.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">"Upload Artifacts"</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">actions/upload-artifact@v2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="comment"># Call the compressed artifact the same name as the configuration with the job ID</span></span><br><span class="line">    <span class="comment"># This will help avoid conflicts between CI artifacts</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.CMAKE_CONFIGURATION</span> <span class="string">&#125;&#125;_$&#123;&#123;</span> <span class="string">env.GITHUB_JOB</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">path:</span> <span class="string">build</span>          <span class="comment"># Save the entire build directory</span></span><br><span class="line">    <span class="attr">retention-days:</span> <span class="number">1</span>    <span class="comment"># Limit the number of days the artifact persists to one day</span></span><br></pre></td></tr></table></figure>
<h2 id="Create-New-Workflow" class="article-heading"><a href="#Create-New-Workflow" class="headerlink" title="Create New Workflow"></a>Create New Workflow<a class="article-anchor" href="#Create-New-Workflow" aria-hidden="true"></a></h2><p>For an example of creating a new CI configuration that uses HDF5 and ADIOS2 and tests on a Linux OS, let’s call it <code>linux_hdf5_adios2</code>. To get started we need a CMake configure file called <code>configure_linux_hdf5_adios2.cmake</code>. This file will be located in the directory <code>&lt;sensei-source&gt;/.github/ci/</code>.</p>
<p>The contents of this file will be pulling in the configurations for HDF5, ADIOS2, and Linux. Note the OS configuration always comes last as it will include additional configurations that may customize some settings based on the features that are configured. One example of this is VTK rendering.</p>
<p><code>&lt;sensei-source&gt;/.github/ci/configure_hdf5_adios2.cmake</code><br><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/configure_hdf5.cmake)</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/configure_adios2.cmake)</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/configure_linux.cmake)</span><br></pre></td></tr></table></figure></p>
<p>Now that the configure file is setup, it is time to add a new job. Because this is a linux job, we will use the <code>sensei-ci:latest</code> docker image. This image contains all of the possible dependencies for SENSEI that may be tested in CI. As more features are made available to CI additional jobs will be introduced to build and test them.</p>
<ul>
<li>ADIOS2</li>
<li>Catalyst</li>
<li>HDF5</li>
<li>Python 3</li>
<li>VTK</li>
</ul>
<p>In the os-linux.yml a new job can be added under the <code>jobs</code> section of the yaml.</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">linux-hdf5-adios2:</span></span><br><span class="line">  <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">  <span class="attr">container:</span></span><br><span class="line">    <span class="comment"># By using the latest container the CI will automatically update dependencies</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ryankrattiger/sensei-ci:latest</span></span><br><span class="line">    <span class="attr">options:</span> <span class="string">--user=root</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="comment"># This launcher is required when using the sensei-ci container since it uses spack as a backend.</span></span><br><span class="line">    <span class="comment"># Eventually this requirement will be removed</span></span><br><span class="line">    <span class="attr">LAUNCHER:</span> <span class="string">.github/ci/docker/spack/launcher.sh</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">CMAKE_CONFIGURATION:</span> <span class="string">linux_hdf5_adios2</span></span><br><span class="line"> <span class="attr">steps:</span></span><br><span class="line"> <span class="comment"># GitHub Action to clone sensei and checkout the triggering branch</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">action/checkout@v2</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># Run the Configure/Build/Test steps in order</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configure</span></span><br><span class="line">   <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_configure.cmake</span></span><br><span class="line"></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">   <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_build.cmake</span></span><br><span class="line"></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Test</span></span><br><span class="line">   <span class="attr">run:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.LAUNCHER</span> <span class="string">&#125;&#125;</span> <span class="string">ctest</span> <span class="string">-VV</span> <span class="string">-S</span> <span class="string">.github/ci/ctest_test.cmake</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># (Optional) Upload the CI artifacts</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">"Upload Artifacts"</span></span><br><span class="line">   <span class="attr">uses:</span> <span class="string">actions/upload-artifact@v2</span></span><br><span class="line">   <span class="attr">with:</span></span><br><span class="line">     <span class="attr">name:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.CMAKE_CONFIGURATION</span> <span class="string">&#125;&#125;_$&#123;&#123;</span> <span class="string">env.GITHUB_JOB</span> <span class="string">&#125;&#125;</span></span><br><span class="line">     <span class="attr">path:</span> <span class="string">build</span></span><br><span class="line">     <span class="attr">retention-days:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2021-06-22T23:31:23.837Z" itemprop="dateModified">Last updated: 2021-06-22</time>
                <a href="testing.html" class="article-footer-prev" title="Testing"><i class="fa fa-chevron-left"></i><span>Prev</span></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Continuous-Integration-CI"><span class="toc-text">Continuous Integration (CI)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Setting-up-a-new-CI-job"><span class="toc-text">Setting up a new CI job</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure"><span class="toc-text">Configure</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Build"><span class="toc-text">Build</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test"><span class="toc-text">Test</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Upload-Artifacts"><span class="toc-text">Upload Artifacts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-New-Workflow"><span class="toc-text">Create New Workflow</span></a></li></ol></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><strong class="sidebar-title">Using</strong><a href="index.html" class="sidebar-link">Overview</a><a href="python-analysis.html" class="sidebar-link">Python Analysis</a><a href="adios-schema.html" class="sidebar-link">Dataset schema</a><strong class="sidebar-title">Contributing</strong><a href="contribute.html" class="sidebar-link">Overview</a><a href="testing.html" class="sidebar-link">Testing</a><a href="CI.html" class="sidebar-link current">CI</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2021 <a href="https://sensei-insitu.org/" target="_blank">sensei</a>
    </div>
    <div id="footer-links">
      <a href="https://github.com/SENSEI-insitu/SENSEI" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/learn-more/" class="mobile-nav-link">Learn more</a><a href="/develop/" class="mobile-nav-link">Develop</a><a href="/news/" class="mobile-nav-link">News</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/SENSEI-insitu/SENSEI" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title">Using</strong><a href="index.html" class="mobile-nav-link">Overview</a><a href="python-analysis.html" class="mobile-nav-link">Python Analysis</a><a href="adios-schema.html" class="mobile-nav-link">Dataset schema</a><strong class="mobile-nav-title">Contributing</strong><a href="contribute.html" class="mobile-nav-link">Overview</a><a href="testing.html" class="mobile-nav-link">Testing</a><a href="CI.html" class="mobile-nav-link current">CI</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/js/lang_select.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>



</body>
</html>